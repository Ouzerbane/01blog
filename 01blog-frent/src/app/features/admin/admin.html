<div class="admin-dashboard">

  <h1 class="title">Admin Dashboard</h1>

  <div class="admin-grid">

    <!-- ================= USERS ================= -->
    <section class="admin-section">
      <h2>Users</h2>

      <mat-card>
        <table mat-table [dataSource]="users" class="mat-elevation-z1">

          <!-- Username -->
          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef> Username </th>
            <td mat-cell *matCellDef="let user"> {{ user.username }} </td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let user">
              <span class="status active">{{ user.action }}</span>
            </td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let user">
              <button mat-button color="warn" (click)="showConfirmBan(user)">
                {{ user.ban }}
              </button>
              <button mat-button color="accent" (click)="showpopap(user)">
                Delete
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['username','status','actions']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['username','status','actions'];"></tr>
        </table>
      </mat-card>

      @for (user of users; track user.id) {
      @if (user.showConfirm) {
      <div class="modal-overlay">
        <mat-card class="confirm-modal">
          <h3>Confirmation</h3>
          <p>Are you sure you want to remove {{ user.username }} ?</p>
          <div class="modal-actions">
            <button mat-button (click)="showpopap(user)">Cancel</button>
            <button mat-raised-button color="warn" (click)="DeletUser(user.id)">
              Confirm
            </button>
          </div>
        </mat-card>
      </div>
      }

      @if (user.showConfirmBan) {
      <div class="modal-overlay">
        <mat-card class="confirm-modal">
          <h3>Confirmation</h3>
          <p>Are you sure you want to change status {{ user.username }} ?</p>
          <div class="modal-actions">
            <button mat-button (click)="cancelBan(user)">Cancel</button>
            <button mat-raised-button color="warn" (click)="confirmBan(user)">
              Confirm
            </button>
          </div>
        </mat-card>
      </div>
      }
      }

    </section>

    <!-- ================= POSTS ================= -->
    <section class="admin-section">
      <h2>Posts</h2>

      <div class="posts-grid">
        @for (post of posts; track post.id) {
        <mat-card class="post-card">

          <div class="post-header">
            @if (post.author.imageUrl) {
            <img [src]="post.author.imageUrl" alt="{{ post.author.username }}" class="user-avatar" />
            }@else {
            <div class="avatar-letter user-avatar">
              {{ post.author.username.charAt(0) | uppercase }}
            </div>
            }
            <span class="author">{{ post.author.username }}</span>
            <span class="time">{{ post.createdAt | date:'short' }}</span>
          </div>

          <h4 class="post-title1">{{ post.title }}</h4>
          <p class="post-content1">{{ post.content }}</p>

          @if (post.media && post.media.length > 0) {
          <div [ngClass]="'media-grid media-count-' + post.media.length">
            @for (item of post.media; track $index) {
            <div class="media-item">
              @if (item.type === 'IMAGE') {
              <img [src]="item.url" [alt]="post.title" class="media-content">
              }
              @if (item.type === 'VIDEO') {
              <video [src]="item.url" controls class="media-content"></video>
              }
            </div>
            }
          </div>
          }

          <div class="post-actions">
            <button mat-button color="primary" (click)="showConfirmHid(post)">
              {{ post.status }}
            </button>
            <button mat-button color="warn" (click)="showpopap(post)">
              Delete
            </button>
          </div>

          @if (post.showConfirm) {
          <div class="modal-overlay">
            <mat-card class="confirm-modal">
              <h3>Confirmation</h3>
              <p>Are you sure you want to remove this post?</p>
              <div class="modal-actions">
                <button mat-button (click)="showpopap(post)">Cancel</button>
                <button mat-raised-button color="warn" (click)="deletePost(post)">
                  Confirm
                </button>
              </div>
            </mat-card>
          </div>
          }

          @if (post.showConfirmHid) {
          <div class="modal-overlay">
            <mat-card class="confirm-modal">
              <h3>Confirmation</h3>
              <p>Are you sure you want to change post status?</p>
              <div class="modal-actions">
                <button mat-button (click)="cancelHid(post)">Cancel</button>
                <button mat-raised-button color="warn" (click)="confirmHid(post)">
                  Confirm
                </button>
              </div>
            </mat-card>
          </div>
          }

        </mat-card>
        }
      </div>
    </section>

    <!-- ================= REPORTS ================= -->
    <section class="admin-section">
      <h2>Reports</h2>

      @for (report of reports; track report.id) {
      <mat-card class="report-card">
        <p><strong>report type: </strong> {{ report.type }} </p>
        <p><strong>Time:</strong> {{ report.time | date:'short' }} </p>
        @if (report.type === 'USER') {
        <p><strong>Reporter:</strong> {{ report.reporter }}</p>
        <p><strong>Target User:</strong> {{ report.targetUser }}</p>
        <p><strong>Reason:</strong> {{ report.reason }}</p>
        }
        @if (report.type === 'POST') {
        <p><strong>Reporter:</strong> {{ report.reporter }}</p>
        <p><strong>Reason:</strong> {{ report.reason }}</p>
        <p><strong>Target Post:</strong> {{ report.targetPost }}</p>
        }

        <div class="report-actions">
          <button mat-raised-button color="warn" (click)="openRemoveProfile(report)">
            Remove
          </button>
        </div>
        @if (report.showConfirm) {
        <div class="modal-overlay">
          <mat-card class="confirm-modal">
            <h3>Confirmation</h3>
            <p>Are you sure you want to remove this post?</p>
            <div class="modal-actions">
              <button mat-button (click)="cancelRemoveProfile(report)">Cancel</button>
              <button mat-raised-button color="warn" (click)="activRemoveProfile(report)">
                Confirm
              </button>
            </div>
          </mat-card>
        </div>
        }
      </mat-card>
      }
    </section>

  </div>
</div>